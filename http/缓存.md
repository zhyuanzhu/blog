# 缓存

## 命中和未命中

> `缓存再验证`：缓存对缓存对副本进行再验证时，会向服务器发送一个小对再验证请求。如果内容没有变化，服务器会返回 `304 Not Modifyied` 进行响应。只要缓存知道副本仍然有效，就会再次将副本标识为暂时新鲜的，并将副本提供给客户端。这被称为 `再验证命中` 或 `缓慢命中`

- 请求示例

  - 命中缓存，直接返回缓存数据

  - 未命中缓存，查看缓存是否新鲜，缓存和服务器资源比对

    - 缓存新鲜，返回缓存数据

    - 缓存过期了，返回服务器信息，同时更新缓存中的数据

![image text](./images/cache.drawio.svg)

## 缓存的处理步骤

- 接收： 缓存从网络中读取抵达的请求报文

- 解析：缓存对报文进行解析，提取出 URL 和各种首部

  - 将请求报文解析为片断，将首部的各个部分放于易于操作的数据结构中。 `便于缓存软件更容易处理首部字段`

- 查询：缓存查看是否有本地副本可用，如果没有，就读取一份（并将其保存在本地）

  - 查看缓存中是否有副本，如果没就去原始服务器或父级代理中去取，或返回一条错误信息

  - 已缓存对象包含了服务器响应主体和原始服务器响应首部，这样就会在 `缓存命中` 时返回正确的服务器首部。

- 新鲜度检测：缓存查看已缓存副本是否足够新鲜，如果不是，就询问服务器是否有任何更新

- 创建响应：缓存会用新的首部和已缓存的主体来构建一条响应报文

- 日志：缓存可选地创建一个日志文件来描述这个事务




